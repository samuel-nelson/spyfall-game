// Spyfall game locations - organized by set
// Spyfall 1 locations (original set)
const SPYFALL1_LOCATIONS = [
    {
        name: "Airplane",
        roles: ["Pilot", "Passenger", "Flight Attendant", "Mechanic", "Air Marshal"]
    },
    {
        name: "Bank",
        roles: ["Teller", "Customer", "Security Guard", "Manager", "Robber"]
    },
    {
        name: "Beach",
        roles: ["Lifeguard", "Swimmer", "Beach Goer", "Ice Cream Vendor", "Photographer"]
    },
    {
        name: "Casino",
        roles: ["Dealer", "Gambler", "Security", "Bartender", "Manager"]
    },
    {
        name: "Cathedral",
        roles: ["Priest", "Worshipper", "Tourist", "Choir Member", "Janitor"]
    },
    {
        name: "Circus Tent",
        roles: ["Clown", "Acrobat", "Juggler", "Ringmaster", "Spectator"]
    },
    {
        name: "Corporate Party",
        roles: ["Manager", "Employee", "Intern", "CEO", "Entertainer"]
    },
    {
        name: "Crusader Army",
        roles: ["Knight", "Archer", "Monk", "Servant", "Spy"]
    },
    {
        name: "Day Spa",
        roles: ["Client", "Masseuse", "Receptionist", "Stylist", "Masseur"]
    },
    {
        name: "Embassy",
        roles: ["Ambassador", "Diplomat", "Security", "Government Official", "Refugee"]
    },
    {
        name: "Hospital",
        roles: ["Doctor", "Nurse", "Patient", "Surgeon", "Visitor"]
    },
    {
        name: "Hotel",
        roles: ["Guest", "Receptionist", "Bellhop", "Maid", "Manager"]
    },
    {
        name: "Military Base",
        roles: ["Soldier", "Officer", "Medic", "Engineer", "Spy"]
    },
    {
        name: "Movie Studio",
        roles: ["Director", "Actor", "Cameraman", "Stuntman", "Costume Designer"]
    },
    {
        name: "Ocean Liner",
        roles: ["Captain", "Passenger", "Bartender", "Mechanic", "Rich Passenger"]
    },
    {
        name: "Passenger Train",
        roles: ["Mechanic", "Passenger", "Conductor", "Restaurant Chef", "Border Patrol"]
    },
    {
        name: "Pirate Ship",
        roles: ["Captain", "Sailor", "Cook", "Slave", "Cannoneer"]
    },
    {
        name: "Polar Station",
        roles: ["Scientist", "Explorer", "Medic", "Geologist", "Meteorologist"]
    },
    {
        name: "Police Station",
        roles: ["Criminal", "Detective", "Journalist", "Lawyer", "Police Officer"]
    },
    {
        name: "Restaurant",
        roles: ["Waiter", "Customer", "Chef", "Critic", "Owner"]
    },
    {
        name: "School",
        roles: ["Teacher", "Student", "Principal", "Janitor", "Parent"]
    },
    {
        name: "Service Station",
        roles: ["Manager", "Tire Specialist", "Biker", "Car Owner", "Mechanic"]
    },
    {
        name: "Space Station",
        roles: ["Engineer", "Alien", "Pilot", "Commander", "Scientist"]
    },
    {
        name: "Submarine",
        roles: ["Captain", "Sailor", "Cook", "Radioman", "Mechanic"]
    },
    {
        name: "Supermarket",
        roles: ["Customer", "Cashier", "Butcher", "Janitor", "Security Guard"]
    },
    {
        name: "Theater",
        roles: ["Actor", "Audience Member", "Coat Check Lady", "Director", "Prompter"]
    },
    {
        name: "University",
        roles: ["Graduate Student", "Professor", "Dean", "Student", "Janitor"]
    },
    {
        name: "World War II Squad",
        roles: ["Soldier", "Medic", "Radioman", "Sniper", "Officer"]
    }
];

// Spyfall 2 locations (second set)
const SPYFALL2_LOCATIONS = [
    {
        name: "Airport",
        roles: ["Pilot", "Passenger", "Security", "Customs Officer", "Mechanic"]
    },
    {
        name: "Amusement Park",
        roles: ["Visitor", "Ride Operator", "Food Vendor", "Security", "Maintenance Worker"]
    },
    {
        name: "Art Gallery",
        roles: ["Visitor", "Artist", "Curator", "Security Guard", "Critic"]
    },
    {
        name: "Baseball Stadium",
        roles: ["Player", "Spectator", "Umpire", "Vendor", "Security"]
    },
    {
        name: "Broadway Theater",
        roles: ["Actor", "Audience Member", "Director", "Stagehand", "Critic"]
    },
    {
        name: "Casino",
        roles: ["Dealer", "Gambler", "Security", "Bartender", "Manager"]
    },
    {
        name: "Cathedral",
        roles: ["Priest", "Worshipper", "Tourist", "Choir Member", "Janitor"]
    },
    {
        name: "Circus Tent",
        roles: ["Clown", "Acrobat", "Juggler", "Ringmaster", "Spectator"]
    },
    {
        name: "Corporate Party",
        roles: ["Manager", "Employee", "Intern", "CEO", "Entertainer"]
    },
    {
        name: "Crusader Army",
        roles: ["Knight", "Archer", "Monk", "Servant", "Spy"]
    },
    {
        name: "Day Spa",
        roles: ["Client", "Masseuse", "Receptionist", "Stylist", "Masseur"]
    },
    {
        name: "Embassy",
        roles: ["Ambassador", "Diplomat", "Security", "Government Official", "Refugee"]
    },
    {
        name: "Hospital",
        roles: ["Doctor", "Nurse", "Patient", "Surgeon", "Visitor"]
    },
    {
        name: "Hotel",
        roles: ["Guest", "Receptionist", "Bellhop", "Maid", "Manager"]
    },
    {
        name: "Military Base",
        roles: ["Soldier", "Officer", "Medic", "Engineer", "Spy"]
    },
    {
        name: "Movie Studio",
        roles: ["Director", "Actor", "Cameraman", "Stuntman", "Costume Designer"]
    },
    {
        name: "Ocean Liner",
        roles: ["Captain", "Passenger", "Bartender", "Mechanic", "Rich Passenger"]
    },
    {
        name: "Passenger Train",
        roles: ["Mechanic", "Passenger", "Conductor", "Restaurant Chef", "Border Patrol"]
    },
    {
        name: "Pirate Ship",
        roles: ["Captain", "Sailor", "Cook", "Slave", "Cannoneer"]
    },
    {
        name: "Polar Station",
        roles: ["Scientist", "Explorer", "Medic", "Geologist", "Meteorologist"]
    },
    {
        name: "Police Station",
        roles: ["Criminal", "Detective", "Journalist", "Lawyer", "Police Officer"]
    },
    {
        name: "Restaurant",
        roles: ["Waiter", "Customer", "Chef", "Critic", "Owner"]
    },
    {
        name: "School",
        roles: ["Teacher", "Student", "Principal", "Janitor", "Parent"]
    },
    {
        name: "Service Station",
        roles: ["Manager", "Tire Specialist", "Biker", "Car Owner", "Mechanic"]
    },
    {
        name: "Space Station",
        roles: ["Engineer", "Alien", "Pilot", "Commander", "Scientist"]
    },
    {
        name: "Submarine",
        roles: ["Captain", "Sailor", "Cook", "Radioman", "Mechanic"]
    },
    {
        name: "Supermarket",
        roles: ["Customer", "Cashier", "Butcher", "Janitor", "Security Guard"]
    },
    {
        name: "Theater",
        roles: ["Actor", "Audience Member", "Coat Check Lady", "Director", "Prompter"]
    },
    {
        name: "University",
        roles: ["Graduate Student", "Professor", "Dean", "Student", "Janitor"]
    },
    {
        name: "World War II Squad",
        roles: ["Soldier", "Medic", "Radioman", "Sniper", "Officer"]
    }
];

// Custom locations (stored in localStorage)
let CUSTOM_LOCATIONS = [];

// Load custom locations from localStorage
function loadCustomLocations() {
    try {
        const saved = localStorage.getItem('customLocations');
        if (saved) {
            CUSTOM_LOCATIONS = JSON.parse(saved);
        }
    } catch (e) {
        console.error('Error loading custom locations:', e);
        CUSTOM_LOCATIONS = [];
    }
}

// Save custom locations to localStorage
function saveCustomLocations() {
    try {
        localStorage.setItem('customLocations', JSON.stringify(CUSTOM_LOCATIONS));
    } catch (e) {
        console.error('Error saving custom locations:', e);
    }
}

// Initialize on load
loadCustomLocations();

// Get all enabled locations based on game settings
function getAllEnabledLocations(enabledSets = ['spyfall1'], customLocations = []) {
    let locations = [];
    
    if (enabledSets.includes('spyfall1')) {
        locations = locations.concat(SPYFALL1_LOCATIONS);
    }
    
    if (enabledSets.includes('spyfall2')) {
        locations = locations.concat(SPYFALL2_LOCATIONS);
    }
    
    if (enabledSets.includes('custom') && customLocations.length > 0) {
        locations = locations.concat(customLocations);
    }
    
    return locations;
}

// Get a random location from enabled sets
function getRandomLocation(enabledSets = ['spyfall1'], customLocations = []) {
    const allLocations = getAllEnabledLocations(enabledSets, customLocations);
    if (allLocations.length === 0) {
        // Fallback to Spyfall 1 if no locations enabled
        return SPYFALL1_LOCATIONS[Math.floor(Math.random() * SPYFALL1_LOCATIONS.length)];
    }
    return allLocations[Math.floor(Math.random() * allLocations.length)];
}

// Get location by name
function getLocationByName(name, enabledSets = ['spyfall1'], customLocations = []) {
    const allLocations = getAllEnabledLocations(enabledSets, customLocations);
    return allLocations.find(loc => loc.name === name);
}

// Export locations to JSON (secure - only data, no code)
function exportLocations() {
    const exportData = {
        version: '1.0',
        spyfall1: SPYFALL1_LOCATIONS,
        spyfall2: SPYFALL2_LOCATIONS,
        custom: CUSTOM_LOCATIONS,
        exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `spyfall-locations-${Date.now()}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Import locations from JSON (secure - only parse JSON, no code execution)
function importLocations(file, callback) {
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            // Validate structure
            if (!data || typeof data !== 'object') {
                throw new Error('Invalid file format');
            }
            
            // Only import custom locations (for security - we don't overwrite built-in sets)
            if (data.custom && Array.isArray(data.custom)) {
                // Validate each location has name and roles array
                const validCustom = data.custom.filter(loc => 
                    loc && 
                    typeof loc.name === 'string' && 
                    Array.isArray(loc.roles) &&
                    loc.roles.length > 0
                );
                
                CUSTOM_LOCATIONS = validCustom;
                saveCustomLocations();
                callback(true, `Imported ${validCustom.length} custom locations`);
            } else {
                callback(false, 'No custom locations found in file');
            }
        } catch (error) {
            console.error('Import error:', error);
            callback(false, 'Invalid JSON file: ' + error.message);
        }
    };
    reader.onerror = function() {
        callback(false, 'Error reading file');
    };
    reader.readAsText(file);
}

// Legacy support - maintain LOCATIONS array for backward compatibility
const LOCATIONS = SPYFALL1_LOCATIONS;
